# üß† ManualReaderPro Node ‚Üí CMD ‚Üí Registry Access Detection

**Author:** Saravanan Balachandran  
**Created:** 2025-11-12  
**Platform:** Windows  
**Data Source:** `DeviceProcessEvents`  
**Purpose:** Identify suspicious behavior where the **ManualReaderPro** application (Node-based) spawns `cmd.exe` to run a `reg.exe QUERY HKLM\Software\Microsoft\Cryptography /v MachineGuid` command‚Äîactivity often seen in malware that fingerprints a host or prepares persistence.

---

## üß© MITRE ATT&CK Mapping

| Technique ID | Technique Name | Tactic |
|---------------|----------------|--------|
| T1059.003 | Windows Command Shell | Execution |
| T1059.007 | JavaScript (Node.js) | Execution |
| T1082 | System Information Discovery | Discovery |
| T1012 | Query Registry | Discovery |
| T1218 | Signed Binary Proxy Execution | Defense Evasion |

> *Notes:* Reading `MachineGuid` via `reg.exe` is a known technique for uniquely identifying a machine during malware staging or licensing evasion.

---

## üìù Description
This query detects when the **ManualReaderPro** application‚Äîinstalled under `%AppData%\Local\Programs\ManualReaderPro\`‚Äîspawns `cmd.exe` (which then runs `reg.exe QUERY HKLM\Software\Microsoft\Cryptography /v MachineGuid`).  
The pattern uses the **original file name** `node.exe`, the parent path of ManualReaderPro, and a regex GUID match to identify unique payload instances.

---

## ‚öôÔ∏è Detection Settings (defaults)
- **Timeframe:** not explicitly bounded (use last 30 days by default)  
- **Parent process:** `node.exe` (from ManualReaderPro path)  
- **Child process:** `cmd.exe` executing `reg.exe QUERY MachineGuid`  
- **Integrity level:** `Medium` (user-level process)  

---

## üîé Investigation Tips
- Confirm if ManualReaderPro is a legitimate user install or a malicious copycat.  
- Review the `MachineGuid` registry query context ‚Äî malware uses it to generate host IDs for C2 registration.  
- Check if any subsequent processes (`msiexec`, `schtasks`, `powershell`) follow this chain.  
- Examine network connections near the timestamp for possible exfiltration or registration traffic.

---

## üö® Response Guidance
- Quarantine the system if ManualReaderPro was not intentionally installed.  
- Re-image or remove the application and clear associated scheduled tasks.  
- Monitor for additional `MachineGuid` queries from user contexts.  

---

## ‚ö†Ô∏è Known False Positives
- Legitimate ManualReaderPro updates using registry access for licensing validation (rare).  
- Developer tools that bundle Node.js and query MachineGuid for telemetry.  

---

## üè∑Ô∏è Tags
`manualreaderpro`, `nodejs`, `cmd`, `registry`, `machineguid`, `execution`, `discovery`, `windows`, `kql`, `sentinel`

---

## üìú KQL Query
```kql
DeviceProcessEvents
| where InitiatingProcessIntegrityLevel == "Medium"
| where InitiatingProcessFolderPath has @"\AppData\Local\Programs\ManualReaderPro\"
| where FileName == "cmd.exe"
| where InitiatingProcessVersionInfoOriginalFileName == "node.exe"
| where ProcessCommandLine has_all(@'cmd.exe /d /s /c "', @':\WINDOWS\system32\reg.exe QUERY "HKLM\Software\Microsoft\Cryptography" /v MachineGuid"')
| where InitiatingProcessCommandLine has @"\AppData\Local\Programs\ManualReaderPro\"
| where InitiatingProcessCommandLine matches regex @"[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
| sort by Timestamp, DeviceId asc
